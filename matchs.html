<script>
(async function(){
  const list = document.getElementById("matchList");

  let res;
  try { res = await fetch("/data.json?ts=" + Date.now(), { cache: "no-store" }); }
  catch(e){ list.innerHTML = `<div class="card"><b>Erreur rÃ©seau :</b> impossible de charger data.json</div>`; return; }

  if (!res.ok) {
    list.innerHTML = `<div class="card"><b>Erreur :</b> data.json introuvable (${res.status})</div>`;
    return;
  }

  const data = await res.json();
  const playersById = Object.fromEntries((data.players || []).map(p => [p.id, p]));

  if (!data.matches || data.matches.length === 0) {
    list.innerHTML = `<div class="card">Aucun match enregistrÃ©.</div>`;
    return;
  }

  list.innerHTML = "";

  data.matches.forEach(m => {
    const a = playersById[m.aId]?.name || m.aId;
    const b = playersById[m.bId]?.name || m.bId;

    const done = m.status === "TERMINE";
    const scoreTxt = done ? `${m.scoreA} - ${m.scoreB}` : "Ã€ jouer";

    const winner = done ? (playersById[m.winnerId]?.name || m.winnerId) : "";
    const loser  = done ? (playersById[m.loserId]?.name || m.loserId) : "";

    const winnerTag = done
      ? `<span class="tag ok">ðŸŸ¢ ${winner} â€” QUALIFIÃ‰</span>`
      : `<span class="tag wait">ðŸŸ  Match en attente</span>`;

    const loserTag = done
      ? `<span class="tag ko">ðŸ”´ ${loser} â€” Ã‰LIMINÃ‰</span>`
      : "";

    // âœ… ICI : image affichÃ©e DIRECTEMENT si proofUrl existe
    const proofBlock = (done && m.proofUrl)
      ? `
        <div style="margin-top:12px;">
          <div class="sub" style="margin-bottom:6px;">ðŸ“¸ Preuve (score)</div>
          <a href="${m.proofUrl}" target="_blank" rel="noopener">
            <img
              src="${m.proofUrl}"
              alt="Preuve du score"
              style="width:100%;max-width:820px;border-radius:14px;border:1px solid #1C2742;display:block;"
              loading="lazy"
            />
          </a>
          <div class="sub" style="margin-top:6px;">Clique sur lâ€™image pour lâ€™ouvrir en grand</div>
        </div>
      `
      : `<div class="sub" style="margin-top:10px;">ðŸ“¸ Preuve : non disponible</div>`;

    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <h2>${m.id.toUpperCase()} Â· ${m.round}</h2>
      <div class="sub">${a} vs ${b}</div>

      <div class="match">
        <div class="row">
          <div><b>Score :</b> ${scoreTxt}</div>
          <div class="sub"><b>Statut :</b> ${m.status}</div>
        </div>

        <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
          ${winnerTag}
          ${loserTag}
        </div>

        ${proofBlock}
      </div>
    `;
    list.appendChild(div);
  });
})();
</script>